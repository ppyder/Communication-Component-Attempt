# Communication-Component-Attempt
Develop COM methods.

# **<font color ="blue">C#上位机通信组件实现</font>**
------

## 简介

此通信组件是基于C#开发的为上位机提供后台信息交互服务的解决方案。

其中包含了可选择的信道类型，简单的数据处理工具集以及方便重定义的通信协议和易于扩展的数据内容。

## 特性

### 1.可定制的通信载体实现

+ **通用设置**
    - 通过属性访问和清空``通知``文本缓冲区并可设置其大小
    - 通过属性设置该组件的信道类型
    - 致命通知以异常方式抛出，非致命通知存在上述``通知``文本缓冲区中。
    - 提供统一的发送数据方法。即基于所选的信道载体调用相应的发送方法即兴数据发送
+ **串口通信**
    - 获取串口连接状态
    - 通过属性设置串口基本参数（串口号、波特率、数据位、停止位、校验位）
    - 提供的操作方法
        * <font color ="brown">从外部实例化串口</font>
        * <font color ="brown">打开/关闭串口</font>
        * <font color ="brown">发送数据</font>
        * <font color ="brown">以线程方式接收数据</font>
+ **网口通信**
    - 获取网口连接状态
    - 通过属性设置网口基本参数（服务器IP、通信端口、视频流地址）
    - 提供的操作方法
        * <font color ="brown">打开/关闭网口</font>
        * <font color ="brown">发送数据</font>
        * <font color ="brown">以线程方式接收数据</font>
        * <font color ="brown">加载指定视频地址的图像到特定的PictureBox</font>

### 2.较灵活丰富的数据处理工具集

+ **数据转换**
    - 字符数组与各类型数据的相互转换
    - 十六进制数转换为同义字符串
    - 将以HEX格式书写的字符串处理为同义字符数组
    - 将以字符格式书写的字符串处理为同义字符数组
+ **数据信息获取**
    - 获取某个类型变量的大小
    - 获取几个整型数中较大的值
    - 获取几个变量类型中所占最大的内存空间大小
    - 获得一个短整型变量各个字节段的数据
+ **一些运算**
    - 计算校验值
        * <font color ="brown">求和校验</font>

### 3.易于自定义和扩展的用户数据类型

+ **通过属性获取数据头、数据尾、数据内容的长度**
+ **用户自定义数据格式和数据内容**

**<font color ="red">note:</font>**

> <1>.目前采用的收发方式是模拟半双工定长缓冲区数据收发。因此数据包具备相同的特性，即皆由数据头、数据内容以及数据尾构成。

> <2>.其中，数据头内容包括长度为两个字节的固定数据头、指令类型、数据反馈和数据头校验；数据尾为整型校验值。

> <3>.数据内容完全由用户自定义，以结构体形式体现。添加新的数据类型时需要进行的操作是：添加新的数据结构体、在枚举清单中添加代表该结构体的数据ID，实现解析此类数据的数据解析函数、在构造函数中增加获取新数据结构大小的指令、在数据处理委托数组中注册数据处理函数。

### 4.通信协议具体实现

+ **支持接收``随机数据``与``格式化数据``，通过相应属性进行使能**
+ **提供数据接收计数器以及正确/错误包统计功能**
+ **提供数据流测速功能（待实现）**
+ **提供可选的HEX格式和字符格式解析字符串数据**
+ **提供可选的消息时间戳功能**
+ **通过属性访问``随机数据``存储缓冲区，并在读取后自动清空**
+ **``随机数据``缓冲区本质上是一个字符串变量，大小可指定**
+ **针对格式化数据的具体通信协议实现**
    - 模拟半双工机制 
        * <font color ="brown">一次发送完成后进入等待状态</font>
        * <font color ="brown">支持重连唤醒操作，即重置发送状态标识以重新激活发送动作</font>
        * <font color ="brown">实时记录本机和通讯方发出和接收到的消息类型，在通讯过程中进行检查，避免有效信息被覆盖</font>
        * <font color ="brown">支持在发送请求过程中识别通信中断和错误状态</font>
    - 发送队列机制（目前还未使用数据结构Queue实现）
        * <font color ="brown">存在三个发送空位，缺省以空白指令（优先级最低）填充</font>
        * <font color ="brown">如果三个空位中的特殊指令都没有被发送出去，阿么新的发送请求将会被丢弃</font>
        * <font color ="brown">按照时间顺序先后对发送的特殊指令进行响应</font>
        * <font color ="brown">指令之间存在优先级（未实现）</font>
    - 基于用户数据定义的数据处理
        * <font color ="brown">具备在随机数据中辨识格式化数据的能力</font>
        * <font color ="brown">基于用户提供的方法进行数据解析</font>
        * <font color ="brown">将错误包以通知的形式存进通知缓冲区以便查错</font>


#### <font color ="purple">@ppyder</font> 2019.03.03
